"use strict";(self.webpackChunkpolls=self.webpackChunkpolls||[]).push([["src_js_components_Export_ExportPoll_vue"],{80210:(s,e,o)=>{o.r(e),o.d(e,{default:()=>x});var i=function(){var t=this,s=t._self._c;return s("NcActions",{scopedSlots:t._u([{key:"icon",fn:function(){return[s("ExportIcon")]},proxy:!0}])},[s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(s){return t.exportFile("xlsx")}},scopedSlots:t._u([{key:"icon",fn:function(){return[s("ExcelIcon")]},proxy:!0}])},[t._v(" "+t._s(t.t("polls","Download Excel spreadsheet"))+" ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(s){return t.exportFile("ods")}},scopedSlots:t._u([{key:"icon",fn:function(){return[s("FileTableIcon")]},proxy:!0}])},[t._v(" "+t._s(t.t("polls","Download Open Document spreadsheet"))+" ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(s){return t.exportFile("csv")}},scopedSlots:t._u([{key:"icon",fn:function(){return[s("CsvIcon")]},proxy:!0}])},[t._v(" "+t._s(t.t("polls","Download CSV file"))+" ")]),s("NcActionButton",{attrs:{"close-after-click":""},on:{click:function(s){return t.exportFile("html")}},scopedSlots:t._u([{key:"icon",fn:function(){return[s("XmlIcon")]},proxy:!0}])},[t._v(" "+t._s(t.t("polls","Download HTML file"))+" ")])],1)};i._withStripped=!0;var l=o(20629),n=o(93162),a=o(84105),r=o(15961),c=o(24612),p=o(78989),h=o(94428),u=o(12926),d=o(42303),m=o(66037);const f={name:"ExportPoll",components:{NcActions:r.O3,NcActionButton:r.Js,CsvIcon:h.Z,ExcelIcon:c.Z,FileTableIcon:p.Z,ExportIcon:d.Z,XmlIcon:u.Z},data:()=>({workBook:[],sheetData:[],emailAddresses:[]}),computed:{...(0,l.Se)({participants:"poll/participantsVoted",getVote:"votes/getVote",explodeDates:"options/explodeDates"}),...(0,l.rn)({poll:t=>t.poll,options:t=>t.options,votes:t=>t.votes,isOwner:t=>t.poll.acl.allowEdit}),sheetName(){return this.poll.title.replaceAll(/[\\/?*[\]]/g,"").slice(0,31)}},methods:{async exportFile(s){const e=[t("polls","Participants")],o=[t("polls","From")],i=[t("polls","To")];if(this.workBook=a.P6.book_new(),this.workBook.SheetNames.push(this.sheetName),this.sheetData=[],["html","xlsx","ods"].includes(s)&&this.sheetData.push([this.poll.title],[this.poll.description]),this.isOwner)try{e.push(t("polls","Email address")),o.push(""),i.push("");const s=await m.e.getParticipantsEmailAddresses(this.$route.params.id);this.emailAddresses=s.data}catch(t){if("CanceledError"===t.name)return}"textPoll"===this.poll.type?this.sheetData.push([...e,...this.options.list.map((t=>t.text))]):["csv"].includes(s)?this.sheetData.push([...e,...this.options.list.map((t=>this.explodeDates(t).iso))]):["html"].includes(s)?this.sheetData.push([...e,...this.options.list.map((t=>this.explodeDates(t).raw))]):(this.sheetData.push([...o,...this.options.list.map((t=>this.explodeDates(t).from.dateTime))]),this.sheetData.push([...i,...this.options.list.map((t=>this.explodeDates(t).to.dateTime))])),["html","ods","xlsx"].includes(s)?this.addVotesArray("symbols"):["csv"].includes(s)?this.addVotesArray("raw"):this.addVotesArray();const l=(0,a.cW)(this.workBook,{bookType:s,type:"binary"});(0,n.saveAs)(new Blob([this.s2ab(l)],{type:"application/octet-stream"}),"poll.".concat(s))},addVotesArray(s){this.participants.forEach((e=>{const o=[e.displayName];try{this.isOwner&&o.push(this.emailAddresses.find((t=>t.displayName===e.displayName)).emailAddress),this.options.list.forEach(((i,l)=>{var n;if("symbols"===s)o.push(null!==(n=this.getVote({userId:e.userId,option:i}).answerSymbol)&&void 0!==n?n:"‚ùå");else if("raw"===s)o.push(this.getVote({userId:e.userId,option:i}).answer);else{var a;o.push(null!==(a=this.getVote({userId:e.userId,option:i}).answerTranslated)&&void 0!==a?a:t("polls","No"))}})),this.sheetData.push(o)}catch(t){}}));const e=a.P6.aoa_to_sheet(this.sheetData);this.workBook.Sheets[this.sheetName]=e},s2ab(t){const s=new ArrayBuffer(t.length),e=new Uint8Array(s);for(let s=0;s<t.length;s++)e[s]=255&t.charCodeAt(s);return s}}};const x=(0,o(51900).Z)(f,i,[],!1,null,null,null).exports}}]);
//# sourceMappingURL=polls-src_js_components_Export_ExportPoll_vue.js.map?v=80ad557a87482fdd3498